/**
 * Minified by jsDelivr using Terser v5.37.0.
 * Original file: /npm/extract-zip@2.0.1/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const debug=require("debug")("extract-zip"),{createWriteStream:createWriteStream,promises:fs}=require("fs"),getStream=require("get-stream"),path=require("path"),{promisify:promisify}=require("util"),stream=require("stream"),yauzl=require("yauzl"),openZip=promisify(yauzl.open),pipeline=promisify(stream.pipeline);class Extractor{constructor(e,i){this.zipPath=e,this.opts=i}async extract(){return debug("opening",this.zipPath,"with opts",this.opts),this.zipfile=await openZip(this.zipPath,{lazyEntries:!0}),this.canceled=!1,new Promise(((e,i)=>{this.zipfile.on("error",(e=>{this.canceled=!0,i(e)})),this.zipfile.readEntry(),this.zipfile.on("close",(()=>{this.canceled||(debug("zip extraction complete"),e())})),this.zipfile.on("entry",(async e=>{if(this.canceled)return void debug("skipping entry",e.fileName,{cancelled:this.canceled});if(debug("zipfile entry",e.fileName),e.fileName.startsWith("__MACOSX/"))return void this.zipfile.readEntry();const t=path.dirname(path.join(this.opts.dir,e.fileName));try{await fs.mkdir(t,{recursive:!0});const i=await fs.realpath(t);if(path.relative(this.opts.dir,i).split(path.sep).includes(".."))throw new Error(`Out of bound path "${i}" found while processing file ${e.fileName}`);await this.extractEntry(e),debug("finished processing",e.fileName),this.zipfile.readEntry()}catch(e){this.canceled=!0,this.zipfile.close(),i(e)}}))}))}async extractEntry(e){if(this.canceled)return void debug("skipping entry extraction",e.fileName,{cancelled:this.canceled});this.opts.onEntry&&this.opts.onEntry(e,this.zipfile);const i=path.join(this.opts.dir,e.fileName),t=e.externalFileAttributes>>16&65535,r=40960==(61440&t);let a=16384==(61440&t);!a&&e.fileName.endsWith("/")&&(a=!0);const s=e.versionMadeBy>>8;a||(a=0===s&&16===e.externalFileAttributes),debug("extracting entry",{filename:e.fileName,isDir:a,isSymlink:r});const n=511&this.getExtractedMode(t,a),o=a?i:path.dirname(i),p={recursive:!0};if(a&&(p.mode=n),debug("mkdir",{dir:o,...p}),await fs.mkdir(o,p),a)return;debug("opening read stream",i);const l=await promisify(this.zipfile.openReadStream.bind(this.zipfile))(e);if(r){const e=await getStream(l);debug("creating symlink",e,i),await fs.symlink(e,i)}else await pipeline(l,createWriteStream(i,{mode:n}))}getExtractedMode(e,i){let t=e;return 0===t&&(i?(this.opts.defaultDirMode&&(t=parseInt(this.opts.defaultDirMode,10)),t||(t=493)):(this.opts.defaultFileMode&&(t=parseInt(this.opts.defaultFileMode,10)),t||(t=420))),t}}module.exports=async function(e,i){if(debug("creating target directory",i.dir),!path.isAbsolute(i.dir))throw new Error("Target directory is expected to be absolute");return await fs.mkdir(i.dir,{recursive:!0}),i.dir=await fs.realpath(i.dir),new Extractor(e,i).extract()};
//# sourceMappingURL=/sm/d6b56b914952b5dcc36e52c286719e98ef0596f6481f99544390229afeef0ba2.map